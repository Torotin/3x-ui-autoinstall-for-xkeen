# Содержание

- [Содержание](#содержание)
- [Введение](#введение)
- [Особенности](#особенности)
- [Требования](#требования)
- [Установка](#установка)
- [Использование](#использование)
- [Доступные опции запуска](#доступные-опции-запуска)
- [Примеры использования](#примеры-использования)
- [Описание модулей](#описание-модулей)
- [Рекомендации по безопасности](#рекомендации-по-безопасности)
- [Устранение неполадок](#устранение-неполадок)
- [Вклад в проект](#вклад-в-проект)
- [Лицензия](#лицензия)

---

# Введение

Этот проект представляет собой скрипт на Bash для автоматической настройки сервера. 

Он значительно упрощает процесс установки и конфигурации таких сервисов, как:

- Создание пользователя для сервера
- Установка и настройка [3X-UI](https://github.com/MHSanaei/3x-ui)
- Настройка SSH и Fail2Ban
- Настройка веб-сервера Caddy
- Оптимизация сети с помощью BBR
- Настройка брандмауэра
- Взаимодействие с API для создания подключениями в 3X-UI

# Особенности

- **Модульная структура**: Разделение на модули для легкости поддержки.
- **Полная автоматизация**: Автоматическая настройка основных сервисов.
- **Гибкость**: Возможность передавать параметры через командную строку или использовать интерактивный режим.
- **Оптимизация сети**: Включение BBR для улучшения сетевой производительности.
- **Увеличение безопасности**: Настройка SSH, Fail2Ban и брандмауэра.



# Требования

- **Операционная система**: Debian 9/10/11 или Ubuntu 18.04/20.04/22.04
- **Права суперпользователя**: Требуется запуск от `root` или через `sudo`.
- **Интернет-соединение**: Для установки пакетов и обновлений.

# Установка

| Шаг | Описание                                     | Команда                                                    |
|-----|----------------------------------------------|------------------------------------------------------------|
| 1   | Клонируйте репозиторий или скачайте скрипт   | `git clone https://github.com/Torotin/3x-ui-autoinstall-for-xkeen.git` <br> `cd 3x-ui-autoinstall-for-xkeen` |
| 2   | Сделайте скрипт исполняемым                  | `chmod +x main.sh`                                          |
| 3   | Запустите скрипт с необходимыми параметрами  | `sudo ./main.sh`                                            |


# Использование

Скрипт поддерживает запуск с параметрами командной строки или в интерактивном режиме.

Если параметры не указаны, необходимые данные запрашиваются у пользователя во время выполнения скрипта.

Стандартные значения переменных можно изменить в файле `variables.sh`.

# Доступные опции запуска

| **Ключ**       | **Описание**                                      |
|----------------|---------------------------------------------------|
| `-u USERNAME`  | Имя нового системного пользователя                |
| `-p PASSWORD`  | Пароль для нового пользователя                    |
| `-l UI_USERNAME` | Имя пользователя для 3X-UI                      |
| `-s UI_PASSWORD` | Пароль для 3X-UI                                |
| `-r RSA_KEY`   | Публичный RSA-ключ                                |
| `-d DOMAIN`    | Доменное имя                                      |
| `-t DEST`      | URL или сайт для маскировки                       |
| `-n SNI`       | Значения SNI через запятую                        |
| `-f`           | Принудительный перезапуск SSH                     |
| `-b`           | Включить BBR                                      |
| `-R`           | Перезагрузить систему по завершению               |
| `-U`           | Обновить и установить пакеты                      |
| `-c`           | Сбросить правила брандмауэра                      |
| `-h`           | Показать справку                                  |


# Примеры использования

1. **Базовая установка в интерактивном режиме**:
   ```bash
    sudo ./main.sh
    ```

2. **Базовая установка без домена**:
    ```bash
    sudo ./main.sh -u admin -p mypassword -l uiuser -s uipassword -r "ssh-rsa AAAAB3NzaC1yc2..." -t https://example.com
    ```

3. **Установка с указанием домена**:
    ```bash
    sudo ./main.sh -u admin -p mypassword -l uiuser -s uipassword -r "ssh-rsa AAAAB3NzaC1yc2..." -d mydomain.com -t https://example.com
    ```

4. **Принудительная перезагрузка и обновление пакетов**:
    ```bash
    sudo ./main.sh -u admin -p mypassword -l uiuser -s uipassword -r "ssh-rsa AAAAB3NzaC1yc2..." -d mydomain.com -t https://example.com -R -U
    ```


# Описание модулей

| **Название модуля**       | **Описание**                                               |
|---------------------------|------------------------------------------------------------|
| `variables.sh`             | Содержит глобальные переменные, необходимые для работы.    |
| `utils.sh`                 | Вспомогательные функции для логирования и проверки команд. |
| `system_checks.sh`         | Проверяет системные ресурсы и подключение к интернету.     |
| `user_input.sh`            | Обрабатывает ввод данных от пользователя.                 |
| `user_setup.sh`            | Создает пользователя, настраивает SSH и Fail2Ban.         |
| `service_setup.sh`         | Устанавливает сервисы, такие как 3X-UI и Caddy.           |
| `network_optimization.sh`  | Включает оптимизацию сети с помощью BBR.                  |
| `firewall_setup.sh`        | Настраивает брандмауэр и открывает порты.                 |
| `api_functions.sh`         | Функции для работы с API 3X-UI.                           |
| `html_create.sh`           | Создает статическую HTML-страницу.                        |


# Рекомендации по безопасности

- Используйте надежные пароли для пользователей.
- Настройте SSH для работы с ключами вместо паролей.
- Регулярно обновляйте систему и пакеты.
- Настройте и активируйте брандмауэр.


# Устранение неполадок

- Логи скрипта находятся в `/var/log/Install_XKeen_Server.log`.
- Убедитесь, что скрипт выполняется от имени `root` или с `sudo`.


# Вклад в проект

Ваши предложения и улучшения всегда приветствуются! Вы можете внести свой вклад в проект следующими способами:

- Форкнуть репозиторий и создать pull request с вашими изменениями.
- Сообщить о проблемах или предложить улучшения через раздел Issues.
- Помогать улучшать документацию и тестировать новые функции.

Ваш вклад поможет сделать проект лучше для всех!


# Лицензия

Проект распространяется под лицензией MIT. Подробности смотрите в файле [LICENSE](LICENSE.md).